{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mtp.schemas.databiomes.com/v1/bloom_1_0_0.json",
  "title": "Protocol",
  "description": "Main model for MTP Protocol JSON structure.",
  "$defs": {
    "Batch": {
      "description": "Model for batches configuration.",
      "properties": {
        "pretrain": {
          "items": {
            "additionalProperties": true,
            "type": "object"
          },
          "title": "Pretrain",
          "type": "array"
        },
        "instruct": {
          "items": {
            "additionalProperties": true,
            "type": "object"
          },
          "title": "Instruct",
          "type": "array"
        },
        "judge": {
          "items": {
            "additionalProperties": true,
            "type": "object"
          },
          "title": "Judge",
          "type": "array"
        },
        "ppo": {
          "items": {
            "additionalProperties": true,
            "type": "object"
          },
          "title": "Ppo",
          "type": "array"
        }
      },
      "required": [
        "pretrain",
        "instruct",
        "judge",
        "ppo"
      ],
      "title": "Batch",
      "type": "object"
    },
    "Guardrail": {
      "description": "Model for guardrails configuration.",
      "properties": {
        "index": {
          "minimum": 0,
          "title": "Index",
          "type": "integer"
        },
        "good_prompt": {
          "minLength": 1,
          "title": "Good Prompt",
          "type": "string"
        },
        "bad_prompt": {
          "minLength": 1,
          "title": "Bad Prompt",
          "type": "string"
        },
        "bad_output": {
          "minLength": 1,
          "title": "Bad Output",
          "type": "string"
        },
        "bad_examples": {
          "description": "At least 3 bad examples per guardrail.",
          "items": {
            "type": "string"
          },
          "minItems": 3,
          "title": "Bad Examples",
          "type": "array"
        }
      },
      "required": [
        "index",
        "good_prompt",
        "bad_prompt",
        "bad_output"
      ],
      "title": "Guardrail",
      "type": "object"
    },
    "Instruction": {
      "description": "Model for instruction configuration.",
      "properties": {
        "memory": {
          "description": "Input lines plus response (e.g. inputs + 1).",
          "minimum": 1,
          "title": "Memory",
          "type": "integer"
        },
        "sets": {
          "items": {
            "$ref": "#/$defs/InstructionSet"
          },
          "minItems": 1,
          "title": "Sets",
          "type": "array"
        }
      },
      "required": [
        "memory",
        "sets"
      ],
      "title": "Instruction",
      "type": "object"
    },
    "InstructionSet": {
      "description": "Model for instruction sets.",
      "properties": {
        "guardrails": {
          "items": {
            "$ref": "#/$defs/Guardrail"
          },
          "title": "Guardrails",
          "type": "array"
        },
        "context": {
          "description": "Instruction context lines.",
          "items": {
            "maxLength": 300,
            "type": "string"
          },
          "maxItems": 100000,
          "title": "Context",
          "type": "array"
        },
        "set": {
          "description": "Token set rows.",
          "items": {
            "items": {
              "maxLength": 300,
              "type": "string"
            },
            "type": "array"
          },
          "title": "Set",
          "type": "array"
        },
        "samples": {
          "description": "At least three samples per instruction set.",
          "items": {
            "$ref": "#/$defs/Sample"
          },
          "minItems": 3,
          "title": "Samples",
          "type": "array"
        },
        "ppo": {
          "items": {
            "additionalProperties": true,
            "type": "object"
          },
          "title": "Ppo",
          "type": "array"
        }
      },
      "required": [
        "set",
        "samples"
      ],
      "title": "InstructionSet",
      "type": "object"
    },
    "Number": {
      "additionalProperties": {
        "description": "Number rule value (must be a string)",
        "type": "string"
      },
      "description": "Model for numbers configuration.",
      "properties": {},
      "title": "Number",
      "type": "object"
    },
    "Sample": {
      "description": "Model for instruction samples.",
      "properties": {
        "strings": {
          "description": "Snippet strings per input/response.",
          "items": {
            "maxLength": 300,
            "type": "string"
          },
          "minItems": 1,
          "title": "Strings",
          "type": "array"
        },
        "prompt": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Prompt"
        },
        "numbers": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            },
            {
              "items": {
                "items": {
                  "type": "integer"
                },
                "type": "array"
              },
              "type": "array"
            }
          ],
          "title": "Numbers"
        },
        "number_lists": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            },
            {
              "items": {
                "items": {
                  "type": "integer"
                },
                "type": "array"
              },
              "type": "array"
            },
            {
              "items": {
                "items": {
                  "items": {
                    "type": "integer"
                  },
                  "type": "array"
                },
                "type": "array"
              },
              "type": "array"
            }
          ],
          "title": "Number Lists"
        },
        "result": {
          "description": "Final token value for this sample.",
          "minLength": 1,
          "title": "Result",
          "type": "string"
        },
        "value": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "integer"
            },
            {
              "type": "number"
            },
            {
              "items": {
                "type": "integer"
              },
              "type": "array"
            },
            {
              "items": {
                "type": "number"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Value"
        }
      },
      "required": [
        "strings",
        "numbers",
        "number_lists",
        "result"
      ],
      "title": "Sample",
      "type": "object"
    },
    "TokenInfo": {
      "description": "Model for individual token information.",
      "properties": {
        "key": {
          "description": "Token key; alphanumeric, underscore, and emoji allowed.",
          "minLength": 1,
          "title": "Key",
          "type": "string"
        },
        "num": {
          "title": "Num",
          "type": "boolean"
        },
        "num_list": {
          "description": "Number of list dimensions for num_list tokens.",
          "minimum": 0,
          "title": "Num List",
          "type": "integer"
        },
        "min_value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Min Value"
        },
        "max_value": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Max Value"
        },
        "length": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Length"
        },
        "desc": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Desc"
        },
        "special": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Special"
        },
        "type": {
          "enum": [
            "Token",
            "SpecialToken",
            "SpecialFinalToken",
            "NumToken",
            "FinalToken",
            "FinalNumToken",
            "NumListToken"
          ],
          "title": "Type",
          "type": "string"
        }
      },
      "required": [
        "key",
        "num",
        "num_list",
        "type"
      ],
      "title": "TokenInfo",
      "type": "object"
    }
  },
  "additionalProperties": true,
  "properties": {
    "name": {
      "minLength": 1,
      "title": "Name",
      "type": "string"
    },
    "inputs": {
      "title": "Inputs",
      "type": "integer"
    },
    "encrypted": {
      "title": "Encrypted",
      "type": "boolean"
    },
    "valid": {
      "title": "Valid",
      "type": "boolean"
    },
    "context": {
      "description": "Protocol-level context lines.",
      "items": {
        "maxLength": 300,
        "type": "string"
      },
      "title": "Context",
      "type": "array"
    },
    "tokens": {
      "additionalProperties": {
        "$ref": "#/$defs/TokenInfo"
      },
      "title": "Tokens",
      "type": "object"
    },
    "special_tokens": {
      "items": {
        "type": "string"
      },
      "title": "Special Tokens",
      "type": "array"
    },
    "instruction": {
      "$ref": "#/$defs/Instruction"
    },
    "numbers": {
      "$ref": "#/$defs/Number"
    },
    "batches": {
      "$ref": "#/$defs/Batch"
    }
  },
  "required": [
    "name",
    "inputs",
    "encrypted",
    "valid",
    "tokens",
    "instruction",
    "numbers",
    "batches"
  ],
  "type": "object"
}